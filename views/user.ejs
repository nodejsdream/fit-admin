<% include header %>
<% include nav %>
<% include functions %>

<div class="container">
  <a href="javascript:history.back()">&lt; Back to search result</a>
  <h1 class="username">
    <%= user.firstName + " " + user.lastName %>
    <div style="float: right;margin-right: 100px;"><input class="form-control" id="fav" name="fav" type="checkbox" <% if(locals.user.fav){ %> checked<% }else{ %><% } %>></div>
  </h1>
  <form class="form-horizontal">

    <div class="row">
      <div class="col-md-4 about">
        <div>
          <h4>ABOUT
            <%= user.firstName.toUpperCase() %>
          </h4>
          <div class="form-group">
            <label class="col-sm-4 control-label">ID</label>
            <div class="col-sm-8">
              <input class="form-control" id="id" type="text" readonly="true" value="<%= user.id %>">
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-4 control-label">FIRST NAME</label>
            <div class="col-sm-8">
              <a href="#" id="firstname" data-type="text" data-pk="1" data-url="/users/" data-title="Enter first name"><%= user.firstName %></a>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-4 control-label">LAST NAME</label>
            <div class="col-sm-8">
              <a href="#" id="lastname" data-type="text" data-pk="1" data-url="/users/" data-title="Enter last name"><%= user.lastName %></a>
            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-4 control-label">EMAIL</label>
            <div class="col-sm-8">
              <a href="#" id="email"  data-type="text" data-pk="1" data-url="/users/" data-title="Enter email"><%= user.email %></a>

            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-4 control-label">PASSWORD</label>
            <div class="col-sm-8">
              <a href="#" id="password"  data-type="text" data-pk="1" data-url="/users/" data-title="Enter password"><%= user.password %></a>

            </div>
          </div>
          <div class="form-group">
            <label class="col-sm-4 control-label">GENDER</label>
            <div class="col-sm-8">
              <a href="#" id="gender" data-type="select" data-pk="1" data-url="/users/" data-title="Enter gender"><%= user.gender %></a>
            </div>
          </div>
        </div>

        <div>
          <h4>FITPLAN APP</h4>
          <div class="form-group">
            <label class="col-sm-4 control-label">LANGUAGE</label>
            <div class="col-sm-8">
              <a href="#" id="language" data-type="select" data-pk="1" data-url="/users/" data-title="Enter language"></a>
            </div>
          </div>
        </div>

        <div>
          <h4>LAST ACTIVE ON FITPLAN APP</h4>
          <div class="form-group">
            <label class="col-sm-4 control-label">LAST SEEN</label>
            <div class="col-sm-8">
              <a href="#" id="last" data-type="text" data-pk="1" data-url="/users/" data-title="Enter last"><%= user.last %></a>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-7">

        <div>
          <h4>SUBSCRIPTION STATUS</h4>
          <div class="panel panel-default">
            <div class="panel-body">
              <ul class="list-group">
                <% for (var i = 0; i < user.userSubscriptions.length; i++) { %>
                  <li class="list-group-item" style="margin-bottom: 15px;">
                    <div class="form-group">
                      <label class="col-sm-4 control-label">ID</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userSubscriptions[i].id %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Store</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userSubscriptions[i].store %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Purchase date</label>
                      <div class="col-sm-8">
                        <input class="form-control" ype="text" value="<%= timeConverter(user.userSubscriptions[i].purchaseDate) %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Expiry date</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= timeConverter(user.userSubscriptions[i].expiryDate) %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Transactin id</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userSubscriptions[i].transactinId %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Is trial</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userSubscriptions[i].isTrial %>">
                      </div>
                    </div>
                  </li>
                  <% } %>
              </ul>
            </div>
          </div>
        </div>


        <div>
          <h4>SUBSCRIPTION OVERVIEW</h4>
          <div class="panel panel-default">
            <div class="panel-body">
                    <div class="form-group">
                      <label class="col-sm-4 control-label" style="color: red; font-weight: bold;">Cancelled</label>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Cancelled  membership</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Started membership</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Started free trial</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Downloaded app</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="">
                      </div>
                    </div>
            </div>
          </div>
        </div>


        <div>
          <h4>SUBSCRIPTION HISTORY</h4>
          <div class="panel panel-default">
            <div class="panel-body">
                    <table style="width:100%">
                     <tr>
                       <th>Store</th>
                       <th>Is trial</th>
                       <th>Expiration date</th>
                       <th>Purchase date</th>
                       <th>Transaction id</th>
                     </tr>
                     <tr>
                       <td>Itune</td>
                       <td>False</td>
                       <td>Mar 21, 17</td>
                       <td>Feb 21, 17</td>
                       <td>ID</td>
                     </tr>
                   </table>
            </div>
          </div>
        </div>



        <div>
          <h4>CURRENT PLAN</h4>
          <div class="panel panel-default">
            <div class="panel-body">
              <ul class="list-group">
                <% for (var i = 0; i < user.userPlanCurrent.length; i++) { %>
                  <li class="list-group-item" style="margin-bottom: 15px;">
                    <div class="form-group">
                      <label class="col-sm-4 control-label">ID</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanCurrent[i].id %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Plan id</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanCurrent[i].planId %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Plane name</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanCurrent[i].planName %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Athlete</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanCurrent[i].athleteFirstName + " " + user.userPlanCurrent[i].athleteLastName %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Start date</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= timeConverter(user.userPlanCurrent[i].startDate) %>">
                      </div>
                    </div>
                  </li>
                  <% } %>
              </ul>
            </div>
          </div>
        </div>

        <div>
          <h4>PREVIOUS PLANS</h4>
          <div class="panel panel-default">
            <div class="panel-body">
              <ul class="list-group">
                <% for (var i = 0; i < user.userPlanPrevious.length; i++) { %>
                  <li class="list-group-item" style="margin-bottom: 15px;">
                    <div class="form-group">
                      <label class="col-sm-4 control-label">ID</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanPrevious[i].id %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Plan id</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanPrevious[i].planId %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Plane name</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanPrevious[i].planName %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Athlete</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanPrevious[i].athleteFirstName + " " + user.userPlanPrevious[i].athleteLastName %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Competition date</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= timeConverter(user.userPlanPrevious[i].completionDate) %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Start date</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= timeConverter(user.userPlanPrevious[i].startDate) %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Plan days count</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanPrevious[i].planDaysCount %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Time spent</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanPrevious[i].timeSpent %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Exercises total</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanPrevious[i].exercisesTotal %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Exercises done</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanPrevious[i].exercisesDone %>">
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Percentage</label>
                      <div class="col-sm-8">
                        <div class="progress">
                          <div class="progress-bar" role="progressbar" aria-valuenow="<%= user.userPlanPrevious[i].percentage %>"  aria-valuemin="0" aria-valuemax="100" style="width:<%= user.userPlanPrevious[i].percentage %>%">
                            <%= user.userPlanPrevious[i].percentage %>%
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="form-group">
                      <label class="col-sm-4 control-label">Single</label>
                      <div class="col-sm-8">
                        <input class="form-control" type="text" value="<%= user.userPlanPrevious[i].single %>">
                      </div>
                    </div>
                  </li>
                  <% } %>
              </ul>
            </div>
          </div>
        </div>

      </div>
    </div>
  </form>

  </br>
</div>


  <script>
      $(document).ready(function() {
          var updateArray = ['firstname', 'lastname', 'last', 'password'];
          updateArray.forEach(function (item, index) {
                $('#'+item).editable({
                  emptytext: 'empty',
                  params: function(params) {
                    params.userId = <%= user.id %>;
                    return params;
                  }
                });
          });

          $('#email').editable({
            params: function(params) {
              params.userId = <%= user.id %>;
              return params;
            },
            validate: function(value) {
                if($.trim(value) == '') {
                    return 'This field is required';
                } else {
                  if (!validateEmail($.trim(value))){
                    return 'Incorrect e-mail adress';
                  }
                }
            }
          });

          $('#fav').click(function(){
              $.ajax({
                  url: '/users/fav',
                  type: 'post',
                  data: { id: <%= user.id %>, book: this.checked  },
                  success:function(data){

                  }
              });
          });

          $('#gender').editable({
              value: "<%= user.gender %>",
              params: function(params) {
                params.userId = <%= user.id %>;
                return params;
              },
              source: [
                  {value: "male", text: 'male'},
                  {value: "female", text: 'female'},
                  {value: "other", text: 'other'}
                 ]
          });

          $('#language').editable({
              value: "<%=  user.language %>",
              source: [{value:"en", text:"English"},{value: "es", text: "Spanish" }],
              params: function(params) {
                params.userId = <%= user.id %>;
                return params;
              },
              success: function(response, newValue) {
                  if(response.status == 'error') return response.msg;
              }
          });
          $('.input-id').each(function( index){$(this).editable();});
          $('.input-text').each(function( index){$(this).editable();});
          $('.input-boolean').each(function(index){$( this ).editable({
              value: $( this ).text(),
              source: [
                  {value: "true", text: 'true'},
                  {value: "false", text: 'false'}
                 ]
          })});



          $('.input-store').each(function(index){$( this ).editable({
              value: $( this ).text(),
              source: [
                  {value: "1", text: 'Google'},
                  {value: "2", text: 'Stripe'},
                  {value: "3", text: 'Apple'},
                  {value: "99", text: 'Test store'}
                 ]
          })});

      });


  </script>
<% include footer %>
